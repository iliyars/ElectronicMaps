<Window x:Class="ElectronicMaps.WPF.Features.Workspace.Components.CreateComponentDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ElectronicMaps.WPF.Features.Workspace.Components"
        mc:Ignorable="d"
        WindowStartupLocation="CenterOwner"
        Height="800"
        Background="{DynamicResource WindowBackground}"
        Width="600">
    <Window.Resources>
        <!-- Стиль для заголовков шагов -->
        <Style x:Key="StepTitle"
               TargetType="TextBlock">
            <Setter Property="FontSize"
                    Value="18" />
            <Setter Property="FontWeight"
                    Value="SemiBold" />
            <Setter Property="Foreground"
                    Value="{DynamicResource TextPrimary}" />
            <Setter Property="Margin"
                    Value="0,0,0,10" />
        </Style>

        <!-- Стиль для подзаголовков -->
        <Style x:Key="StepSubtitle"
               TargetType="TextBlock">
            <Setter Property="FontSize"
                    Value="13" />
            <Setter Property="Foreground"
                    Value="{DynamicResource TextSecondary}" />
            <Setter Property="Margin"
                    Value="0,0,0,20" />
        </Style>
    </Window.Resources>
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!-- Progress bar -->
            <RowDefinition Height="*" />
            <!-- Content -->
            <RowDefinition Height="Auto" />
            <!-- Status -->
            <RowDefinition Height="Auto" />
            <!-- Buttons -->
        </Grid.RowDefinitions>

        <!-- ========== PROGRESS BAR (ШАГ 1/2/3) ========== -->
        <Border Grid.Row="0"
                Background="{DynamicResource PanelBackground}"
                BorderBrush="{DynamicResource CardBorder}"
                BorderThickness="1"
                CornerRadius="6"
                Padding="20,15"
                Margin="0,0,0,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Шаг 1: Имя компонента -->
                <StackPanel Grid.Column="0"
                            HorizontalAlignment="Center">
                    <Ellipse Width="40"
                             Height="40"
                             Margin="0,0,0,8">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill"
                                        Value="{DynamicResource ButtonBackground}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentStep}"
                                                 Value="0">
                                        <Setter Property="Fill"
                                                Value="{DynamicResource AccentBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock Text="Имя"
                               HorizontalAlignment="Center"
                               Foreground="{DynamicResource TextPrimary}"
                               FontSize="12" />
                </StackPanel>

                <!-- Шаг 2: Семейство -->
                <StackPanel Grid.Column="1"
                            HorizontalAlignment="Center">
                    <Ellipse Width="40"
                             Height="40"
                             Margin="0,0,0,8">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill"
                                        Value="{DynamicResource ButtonBackground}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentStep}"
                                                 Value="1">
                                        <Setter Property="Fill"
                                                Value="{DynamicResource AccentBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock Text="Семейство"
                               HorizontalAlignment="Center"
                               Foreground="{DynamicResource TextPrimary}"
                               FontSize="12" />
                </StackPanel>

                <!-- Шаг 3: Компонент -->
                <StackPanel Grid.Column="2"
                            HorizontalAlignment="Center">
                    <Ellipse Width="40"
                             Height="40"
                             Margin="0,0,0,8">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill"
                                        Value="{DynamicResource ButtonBackground}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentStep}"
                                                 Value="2">
                                        <Setter Property="Fill"
                                                Value="{DynamicResource AccentBrush}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock Text="Компонент"
                               HorizontalAlignment="Center"
                               Foreground="{DynamicResource TextPrimary}"
                               FontSize="12" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- ========== CONTENT (АНИМИРОВАННЫЙ) ========== -->
        <Border Grid.Row="1"
                Background="{DynamicResource PanelBackground}"
                BorderBrush="{DynamicResource CardBorder}"
                BorderThickness="1"
                CornerRadius="6"
                Padding="30">
            <Grid>
                <!-- ========== ШАГ 1: ИМЯ КОМПОНЕНТА ========== -->
                <StackPanel x:Name="Step1Panel">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility"
                                    Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding CurrentStep}"
                                             Value="0">
                                    <Setter Property="Visibility"
                                            Value="Visible" />
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                 From="0"
                                                                 To="1"
                                                                 Duration="0:0:0.3" />
                                                <ThicknessAnimation Storyboard.TargetProperty="Margin"
                                                                    From="20,0,0,0"
                                                                    To="0,0,0,0"
                                                                    Duration="0:0:0.3" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>

                    <TextBlock Text="Шаг 1: Имя компонента"
                               Style="{StaticResource StepTitle}" />
                    <TextBlock Text="Введите имя компонента"
                               Style="{StaticResource StepSubtitle}" />

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"
                                              MinWidth="150" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Text="Имя компонента:"
                                   Style="{StaticResource ParameterLabel}" />
                        <TextBox Grid.Column="1"
                                 Text="{Binding ComponentName, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="16"
                                 Height="40" />
                    </Grid>
                </StackPanel>

                <!-- ========== ШАГ 2: ПАРАМЕТРЫ СЕМЕЙСТВА ========== -->
                <ScrollViewer x:Name="Step2Panel"
                              VerticalScrollBarVisibility="Auto">
                    <ScrollViewer.Style>
                        <Style TargetType="ScrollViewer">
                            <Setter Property="Visibility"
                                    Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding CurrentStep}"
                                             Value="1">
                                    <Setter Property="Visibility"
                                            Value="Visible" />
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                 From="0"
                                                                 To="1"
                                                                 Duration="0:0:0.3" />
                                                <ThicknessAnimation Storyboard.TargetProperty="Margin"
                                                                    From="20,0,0,0"
                                                                    To="0,0,0,0"
                                                                    Duration="0:0:0.3" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ScrollViewer.Style>

                    <StackPanel>
                        <TextBlock Text="Шаг 2: Параметры семейства"
                                   Style="{StaticResource StepTitle}" />
                        <TextBlock Style="{StaticResource StepSubtitle}">
                            <Run Text="Семейство:" />
                            <Run Text="{Binding NewFamilyName, Mode=OneWay}"
                                 Foreground="{DynamicResource AccentBrush}"
                                 FontWeight="SemiBold" />
                        </TextBlock>

                        <!-- Имя семейства -->
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"
                                                  MinWidth="150" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0"
                                       Text="Имя семейства:"
                                       Style="{StaticResource ParameterLabel}" />
                            <TextBox Grid.Column="1"
                                     Text="{Binding NewFamilyName, UpdateSourceTrigger=PropertyChanged}"
                                     Height="35" />
                        </Grid>

                        <!-- Параметры семейства -->
                        <TextBlock Text="Параметры:"
                                   Style="{StaticResource ParameterLabel}"
                                   FontWeight="SemiBold"
                                   FontSize="14"
                                   Margin="0,0,0,15" />

                        <ItemsControl ItemsSource="{Binding FamilyParameters}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"
                                                              MinWidth="150" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding DisplayName}"
                                                   Style="{StaticResource ParameterLabel}" />

                                        <TextBox Grid.Column="1"
                                                 Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                 Height="35" />

                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding Unit}"
                                                   Style="{StaticResource UnitLabel}" />
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>

                <!-- ========== ШАГ 3: ПАРАМЕТРЫ КОМПОНЕНТА ========== -->
                <ScrollViewer x:Name="Step3Panel"
                              VerticalScrollBarVisibility="Auto">
                    <ScrollViewer.Style>
                        <Style TargetType="ScrollViewer">
                            <Setter Property="Visibility"
                                    Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding CurrentStep}"
                                             Value="2">
                                    <Setter Property="Visibility"
                                            Value="Visible" />
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                 From="0"
                                                                 To="1"
                                                                 Duration="0:0:0.3" />
                                                <ThicknessAnimation Storyboard.TargetProperty="Margin"
                                                                    From="20,0,0,0"
                                                                    To="0,0,0,0"
                                                                    Duration="0:0:0.3" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ScrollViewer.Style>

                    <StackPanel>
                        <TextBlock Text="Шаг 3: Параметры компонента"
                                   Style="{StaticResource StepTitle}" />
                        <TextBlock Style="{StaticResource StepSubtitle}">
                            <Run Text="Компонент:" />
                            <Run Text="{Binding ComponentName, Mode=OneWay}"
                                 Foreground="{DynamicResource AccentBrush}"
                                 FontWeight="SemiBold" />
                        </TextBlock>

                        <!-- Выбор формы компонента -->
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"
                                                  MinWidth="150" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0"
                                       Text="Форма компонента:"
                                       Style="{StaticResource ParameterLabel}" />
                            <ComboBox Grid.Column="1"
                                      ItemsSource="{Binding AvailableComponentForms}"
                                      SelectedItem="{Binding SelectedComponentForm}"
                                      DisplayMemberPath="Name"
                                      Height="35" />
                        </Grid>

                        <!-- Параметры компонента -->
                        <TextBlock Text="Параметры:"
                                   Style="{StaticResource ParameterLabel}"
                                   FontWeight="SemiBold"
                                   FontSize="14"
                                   Margin="0,0,0,15" />

                        <!-- Если параметров нет -->
                        <TextBlock Text="Выберите форму компонента для загрузки параметров"
                                   Foreground="{DynamicResource TextSecondary}"
                                   FontStyle="Italic"
                                   Margin="0,10">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility"
                                            Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ComponentParameters.Count}"
                                                     Value="0">
                                            <Setter Property="Visibility"
                                                    Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Список параметров -->
                        <ItemsControl ItemsSource="{Binding ComponentParameters}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,0,0,12">
                                        <!-- Обычный параметр -->
                                        <Grid>
                                            <Grid.Style>
                                                <Style TargetType="Grid">
                                                    <Setter Property="Visibility"
                                                            Value="Visible" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HasPins}"
                                                                     Value="True">
                                                            <Setter Property="Visibility"
                                                                    Value="Collapsed" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Grid.Style>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"
                                                                  MinWidth="150" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0"
                                                       Text="{Binding DisplayName}"
                                                       Style="{StaticResource ParameterLabel}" />

                                            <TextBox Grid.Column="1"
                                                     Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                     Height="35" />

                                            <TextBlock Grid.Column="2"
                                                       Text="{Binding Unit}"
                                                       Style="{StaticResource UnitLabel}" />
                                        </Grid>

                                        <!-- Параметр с пинами -->
                                        <StackPanel>
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Setter Property="Visibility"
                                                            Value="Collapsed" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HasPins}"
                                                                     Value="True">
                                                            <Setter Property="Visibility"
                                                                    Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>

                                            <!-- Значение -->
                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"
                                                                      MinWidth="150" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding DisplayName}"
                                                           Style="{StaticResource ParameterLabel}" />

                                                <TextBox Grid.Column="1"
                                                         Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                         Height="35" />

                                                <TextBlock Grid.Column="2"
                                                           Text="{Binding Unit}"
                                                           Style="{StaticResource UnitLabel}" />
                                            </Grid>

                                            <!-- Пины -->
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"
                                                                      MinWidth="150" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="Пины:"
                                                           Style="{StaticResource ParameterLabel}" />

                                                <TextBox Grid.Column="1"
                                                         Text="{Binding Pins, UpdateSourceTrigger=PropertyChanged}"
                                                         ToolTip="Укажите пины через запятую (например: 1,2,3)"
                                                         Height="35" />
                                            </Grid>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- ========== 3. СТАТУС ========== -->
        <TextBlock Grid.Row="2"
                   Text="{Binding StatusMessage}"
                   Foreground="{DynamicResource TextSecondary}"
                   Margin="0,15,0,0"
                   TextWrapping="Wrap" />

        <!-- ========== 4. КНОПКИ НАВИГАЦИИ ========== -->
        <Grid Grid.Row="3"
              Margin="0,15,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Назад -->
            <Button Grid.Column="0"
                    Content="← Назад"
                    Command="{Binding PreviousStepCommand}"
                    Width="120"
                    Height="40" />

            <!-- Далее / Сохранить -->
            <StackPanel Grid.Column="2"
                        Orientation="Horizontal">
                <!-- Далее (шаги 1-2) -->
                <Button Content="Далее →"
                        Command="{Binding NextStepCommand}"
                        Width="120"
                        Height="40"
                        Margin="0,0,10,0">
                    <Button.Style>
                        <Style TargetType="Button"
                               BasedOn="{StaticResource PrimaryButton}">
                            <Setter Property="Visibility"
                                    Value="Visible" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding CurrentStep}"
                                             Value="2">
                                    <Setter Property="Visibility"
                                            Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Сохранить (шаг 3) -->
                <Button Content="Сохранить"
                        Command="{Binding SaveCommand}"
                        Width="120"
                        Height="40"
                        Margin="0,0,10,0">
                    <Button.Style>
                        <Style TargetType="Button"
                               BasedOn="{StaticResource PrimaryButton}">
                            <Setter Property="Visibility"
                                    Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding CurrentStep}"
                                             Value="2">
                                    <Setter Property="Visibility"
                                            Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Отмена -->
                <Button Content="Отмена"
                        Command="{Binding CancelCommand}"
                        Width="120"
                        Height="40" />
            </StackPanel>
        </Grid>

        <!-- ========== OVERLAY ДЛЯ LOADING ========== -->
        <Grid Grid.RowSpan="4"
              Background="#B0000000"
              Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Background="{DynamicResource PanelBackground}"
                    BorderBrush="{DynamicResource CardBorder}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="40"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <StackPanel>
                    <ProgressBar IsIndeterminate="True"
                                 Width="250"
                                 Height="6"
                                 Background="{DynamicResource ButtonBackground}"
                                 Foreground="{DynamicResource AccentBrush}" />
                    <TextBlock Text="{Binding StatusMessage}"
                               Foreground="{DynamicResource TextPrimary}"
                               HorizontalAlignment="Center"
                               Margin="0,20,0,0"
                               FontSize="14"
                               FontWeight="SemiBold" />
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
